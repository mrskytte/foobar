"use strict";function init(){domTickets=document.querySelectorAll(".queue-entry"),getQueueSpacing(),isQueueMoveDone(),getInitialData()}function getQueueSpacing(){const e=document.querySelector("[data-position=one]").getBoundingClientRect().x,r=document.querySelector("[data-position=two]").getBoundingClientRect().x,t=e-r;document.getElementById("container").style.setProperty("--queue-offset",t)}function isQueueMoveDone(){function e(){domTickets.forEach(e=>e.classList.remove("move-queue"))}document.querySelector("[data-position=one]").addEventListener("animationend",e),document.querySelector("[data-position=one]").addEventListener("animationend",moveQueue)}async function getInitialData(){const e=await fetch(endpoint),r=await e.json(),t=Object.values(r.taps),n=await fetch("beers.json"),i=await n.json();beersArray=Object.entries(i);let o=[];t.forEach(e=>{o.push(e.beer)}),beersOnTap=beersArray.filter(e=>o.includes(e[1].name)),currentQueue=[...r.queue],prepareObjects(beersOnTap),prepareNowServing(r.serving),prepareQueue(),startSystem(),countBeers(r.queue),prepareManager(r)}function prepareNowServing(e){nowServing=[...e],nowServing[0]&&(bartenderOneServing.unshift(nowServing[0]),bartenderOneServing.pop(),displayNowServing(bartenderOneServing,1)),nowServing[1]&&(bartenderTwoServing.unshift(nowServing[1]),bartenderTwoServing.pop(),displayNowServing(bartenderTwoServing,2)),nowServing[2]&&(bartenderThreeServing.unshift(nowServing[2]),bartenderThreeServing.pop(),displayNowServing(bartenderThreeServing,3))}function displayNowServing(e,r){const t=document.querySelector(`#serving${r}`),n=e[0].id.toString().length-2,i=e[0].id>100?e[0].id.toString().substring(n):e[0].id.toString().length<2?"0"+e[0].id.toString():e[0].id,o=`url('images/tickets/ticket_${i}.png')`;t.style.setProperty("--image-url",o)}function displayNewNowServing(e,r){function t(){o.classList.add("move"),i.classList.add("move"),i.classList.remove("hide")}function n(){i.style.setProperty("--image-url",s),o.classList.remove("move"),i.classList.remove("move"),i.removeEventListener("animationend",n)}const i=document.querySelector(`#serving${r}`),o=document.querySelector(`#secondserving${r}`),u=e[0].id.toString().length-2,a=e[0].id>100?e[0].id.toString().substring(u):e[0].id.toString().length<2?"0"+e[0].id.toString():e[0].id,s=`url('images/tickets/ticket_${a}.png')`;o.style.setProperty("--image-url",s),t(),i.addEventListener("animationend",n)}function updateNowServing(e){currentlyNowServing=[...e],currentlyNowServing.length<3?removeNowServingTicket():(nowServing.length<3&&nowServing.push({id:"empty"}),nowServing[2].id===currentlyNowServing[0].id?twoNewNowServingEntries():JSON.stringify(currentlyNowServing)!==JSON.stringify(nowServing)&&oneNewNowServingEntry(),nowServing=[...currentlyNowServing])}function twoNewNowServingEntries(){let e=1;currentlyNowServing.some(e=>e.id===bartenderOneServing[0].id)||(bartenderOneServing.unshift(currentlyNowServing[e]),bartenderOneServing.pop(),displayNewNowServing(bartenderOneServing,1),document.querySelector("#serving1").classList.add("remove"),e++),currentlyNowServing.some(e=>e.id===bartenderTwoServing[0].id)||(bartenderTwoServing.unshift(currentlyNowServing[e]),bartenderTwoServing.pop(),displayNewNowServing(bartenderTwoServing,2),document.querySelector("#serving2").classList.add("remove"),e++),currentlyNowServing.some(e=>e.id===bartenderThreeServing[0].id)||(bartenderThreeServing.unshift(currentlyNowServing[e]),bartenderThreeServing.pop(),displayNewNowServing(bartenderThreeServing,3),document.querySelector("#serving3").classList.add("remove"),e++)}function oneNewNowServingEntry(){currentlyNowServing.some(e=>e.id===bartenderOneServing[0].id)?currentlyNowServing.some(e=>e.id===bartenderTwoServing[0].id)?currentlyNowServing.some(e=>e.id===bartenderThreeServing[0].id)||(bartenderThreeServing.unshift(currentlyNowServing[2]),bartenderThreeServing.pop(),displayNewNowServing(bartenderThreeServing,3),document.querySelector("#serving3").classList.add("remove")):(bartenderTwoServing.unshift(currentlyNowServing[2]),bartenderTwoServing.pop(),displayNewNowServing(bartenderTwoServing,2),document.querySelector("#serving2").classList.add("remove")):(bartenderOneServing.unshift(currentlyNowServing[2]),bartenderOneServing.pop(),displayNewNowServing(bartenderOneServing,1),document.querySelector("#serving1").classList.remove("hide"))}function removeNowServingTicket(){currentlyNowServing.some(e=>e.id===bartenderOneServing[0].id)||(bartenderOneServing.unshift({id:"empty"}),bartenderOneServing.pop(),document.querySelector("#serving1").classList.add("hide")),currentlyNowServing.some(e=>e.id===bartenderTwoServing[0].id)||(bartenderTwoServing.unshift({id:"empty"}),bartenderTwoServing.pop(),document.querySelector("#serving2").classList.add("hide")),currentlyNowServing.some(e=>e.id===bartenderThreeServing[0].id)||(bartenderThreeServing.unshift({id:"empty"}),bartenderThreeServing.pop(),document.querySelector("#serving3").classList.add("hide"))}function prepareQueue(){const e=[...domTickets];lastQueue=[...currentQueue],fillOutQueueArray(),domTickets.forEach(e=>e.classList.add("hide-queue"));for(let r=0;r<currentQueue.length;r++){const t=currentQueue[r].id.toString().length-2,n=currentQueue[r].id>100?currentQueue[r].id.toString().substring(t):currentQueue[r].id.toString().length<2?"0"+currentQueue[r].id.toString():currentQueue[r].id;"hideme"!==n?e[r].classList.remove("hide-queue"):e[r].classList.add("hide-queue"),"hideme"===e[r].dataset.id&&"hideme"!==n&&(e[r].classList.add("show-queue"),setTimeout(()=>e[r].classList.remove("show-queue"),1e3)),e[r].dataset.id=n,"hideme"!==n?e[r].style.setProperty("--image-url",`url('images/tickets/ticket_${n}.png')`):e[r].style.setProperty("--image-url","#")}}function fillOutQueueArray(){if(currentQueue.length<7)for(let e=currentQueue.length;e<6;e++)currentQueue.push({id:"hideme"});currentQueue.length=6}function startSystem(){setInterval(updateData,3e3)}async function updateData(){const e=await fetch(endpoint),r=await e.json();checkQueueProgress(r.queue),updateNowServing(r.serving),prepareManager(r),countBeers(r.queue)}function checkQueueProgress(e){currentQueue=[...e],lastQueue.length<currentQueue.length&&prepareQueue(),(currentQueue[0]||lastQueue[0])&&(!currentQueue[0]&&lastQueue[0]?(setIterations(lastQueue.length),lastQueue=[...currentQueue],updateQueue()):!lastQueue[0]&&currentQueue[0]?(lastQueue=[...currentQueue],updateQueue()):lastQueue[0].id!==currentQueue[0].id?(lastQueue.length<3||(lastQueue[1].id===currentQueue[0].id?setIterations(1):lastQueue[2].id===currentQueue[0].id&&setIterations(2)),lastQueue=[...currentQueue],updateQueue()):lastQueue[0].id===currentQueue[0].id||(lastQueue=[...currentQueue],updateQueue()))}function updateQueue(){fillOutQueueArray(),domTickets.forEach(e=>e.classList.add("move-queue"))}function setIterations(e){document.querySelector("#container").style.setProperty("--iterations",e)}function moveQueue(){fillOutQueueArray();for(let e=0;e<6;e++){const r=document.getElementById(`ticket${1+e}`);changeTicketId(r,e),showActiveTickets(r)}}function changeTicketId(e,r){const t=currentQueue[r].id.toString().length-2,n=currentQueue[r].id>100?currentQueue[r].id.toString().substring(t):currentQueue[r].id.toString().length<2?"0"+currentQueue[r].id.toString():currentQueue[r].id;e.dataset.id=n,"hideme"!==n?e.style.setProperty("--image-url",`url('images/tickets/ticket_${n}.png')`):e.style.setProperty("--image-url","#")}function showActiveTickets(){domTickets.forEach(e=>e.classList.add("hide-queue")),setTimeout(()=>domTickets.forEach(e=>{"hideme"!==e.dataset.id&&e.classList.remove("hide-queue")}))}function prepareObjects(e){allBeers=e.map(prepareObject),displayList(allBeers)}function prepareObject(e){const r=Object.create(Beer);r.name=e[1].name,r.type=e[1].type,r.alc=e[1].alc,r.price=e[1].price;let t="images/beers/"+e[1].image+".png";return r.image=t,r}function displayList(e){document.querySelector("#list").innerHTML="",e.forEach(displayBeer)}function displayBeer(e){let r=document.querySelector("#beer-template").content.cloneNode(!0);r.querySelector(".beer > img").src=e.image,r.querySelector(".beer").setAttribute("id",e.name.replace(/\s+/g,"")),r.querySelector("[data-field=name]").textContent=e.name,r.querySelector("[data-field=type]").textContent=e.type,r.querySelector("[data-field=alc]").textContent=e.alc+"%",r.querySelector("[data-field=price]").textContent=e.price+",0kr.",document.querySelector("#list").appendChild(r)}function prepareManager(e){buildTable(e.bartenders),getStorage(e.storage),getTheTap(e.taps)}function buildTable(e){var r=document.getElementById("bartenderr");r.innerHTML="";for(var t=0;t<e.length;t++){var n=`<div class="small-bartender">${e[t].name} ${e[t].status}</div>`;r.innerHTML+=n}}function getStorage(e){var r=document.getElementById("STOCK");r.innerHTML="",e.forEach(e=>{let t="";"El Hefe"===e.name?t="elhefe":"Fairy Tale Ale"===e.name?t="bigdaddy":"GitHop"===e.name?t="githop":"Hollaback Lager"===e.name?t="hollaback":"Hoppily Ever After"===e.name?t="hoppilyeverafter":"Mowintime"===e.name?t="mowingtime":"Row 26"===e.name?t="row26":"Ruined Childhood"===e.name?t="ruinedchildhood":"Sleighride"===e.name?t="sleighride":"Steampunk"===e.name&&(t="steampunk");var n=`<div class="storage"><img src="images/beers/${t}.png" alt="Beer Label"/><br> ${e.name}:<br> ${e.amount}</div>`;r.innerHTML+=n})}function getTheTap(e){var r=document.getElementById("onTap");r.innerHTML="",e.forEach(e=>{let t="";"El Hefe"===e.beer?t="elhefe":"Fairy Tale Ale"===e.beer?t="bigdaddy":"GitHop"===e.beer?t="githop":"Hollaback Lager"===e.beer?t="hollaback":"Hoppily Ever After"===e.beer?t="hoppilyeverafter":"Mowintime"===e.beer?t="mowingtime":"Row 26"===e.beer?t="row26":"Ruined Childhood"===e.beer?t="ruinedchildhood":"Sleighride"===e.beer?t="sleighride":"Steampunk"===e.beer&&(t="steampunk");var n=`<div class="oneTap"><div class="oneTap_img"><img src="images/beers/${t}.png" alt="Beer Label"/></div><div class="oneTap_beer">${e.beer}</div><div class="oneTap_level">${e.level/100} l</div></div>`;r.innerHTML+=n})}function countBeers(e){e.forEach(e=>{e.id>lastCount&&e.order.forEach(e=>beerCount.map(r=>(e===r.name&&r.amount++,{name:r.name,amount:r.amount}))),lastCount=e.id}),setMostWanted()}function setMostWanted(){beerCount.sort((e,r)=>e.amount-r.amount),document.querySelectorAll(".beer").forEach(e=>e.classList.remove("most-wanted")),document.querySelector(`#${beerCount[9].name.replace(/\s+/g,"")}`).classList.add("most-wanted")}window.addEventListener("load",init);let domTickets=[],lastQueue=[],currentQueue=[],nowServing=[],currentlyNowServing=[],bartenderOneServing=[{id:"empty"},{id:"empty"}],bartenderTwoServing=[{id:"empty"},{id:"empty"}],bartenderThreeServing=[{id:"empty"},{id:"empty"}],beersArray=[],allBeers=[],displayedBeers=[],beersOnTap=[];const Beer={image:"",name:"",type:"",price:""},endpoint="https://fireorange-foobar.herokuapp.com";let beerCount=[{name:"El Hefe",amount:0},{name:"Fairy Tale Ale",amount:0},{name:"GitHop",amount:0},{name:"Hollaback Lager",amount:0},{name:"Hoppily Ever After",amount:0},{name:"Mowintime",amount:0},{name:"Row 26",amount:0},{name:"Ruined Childhood",amount:0},{name:"Sleighride",amount:0},{name:"Steampunk",amount:0}],lastCount=0;